
{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>Driver Pay</h1>
  <form method="post" class="grid-3">
    <div>
      <label>Driver</label>
      <select name="driver_id">
        <option value="all">All Drivers</option>
        {% for d in drivers %}<option value="{{ d.id }}">{{ d.name }}</option>{% endfor %}
      </select>
    </div>
    <div>
      <label>From</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <input type="date" name="date_from" id="date_from" required onclick="if(this.showPicker){this.showPicker()}" onfocus="if(this.showPicker){this.showPicker()}">
        <button type="button" class="btn secondary" onclick="openDatePicker('date_from')">📅</button>
      </div>
    </div>
    <div>
      <label>To</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <input type="date" name="date_to" id="date_to" required onclick="if(this.showPicker){this.showPicker()}" onfocus="if(this.showPicker){this.showPicker()}">
        <button type="button" class="btn secondary" onclick="openDatePicker('date_to')">📅</button>
      </div>
    </div>
    <div><button class="btn">Generate</button></div>
  </form>

  {% if items %}
  <h2>Results</h2>
  <table class="table">
    <thead><tr><th>Date</th><th>Driver</th><th>Truck</th><th style="text-align:right;">Amount</th></tr></thead>
    <tbody>
      {% set total = 0 %}
      {% for r in items %}
        {% set amt = r.amount if r.hst_included==1 else (r.amount*1.13) %}
        {% set total = total + amt %}
        <tr>
          <td>{{ r.entry_date }}</td>
          <td>{{ r.driver_name or '-' }}</td>
          <td>{{ r.truck_name or '-' }}</td>
          <td style="text-align:right;">{{ amt|round(2)|currency }}</td>
        </tr>
      {% endfor %}
      <tr>
        <td colspan="3" style="text-align:right;"><strong>Total</strong></td>
        <td style="text-align:right;"><strong>{{ total|round(2)|currency }}</strong></td>
      </tr>
    </tbody>
  </table>
  <a class="btn download" href="{{ url_for('download_report', fname=pdf_path.split('/')[-1]) }}">⬇️ Download PDF</a>
  {% endif %}
</div>
{% endblock %}
