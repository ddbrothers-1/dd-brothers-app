{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Add Income / Expense Entry</h2>
  <form method="post" class="grid-form">
    <div>
      <label>Type</label>
      <select name="mode" id="modeSelect">
        <option value="income">Income</option>
        <option value="expense">Expense</option>
      </select>
    </div>

    <div>
      <label>Date</label>
      <input type="date" name="entry_date" required>
    </div>

    <div>
      <label>Truck</label>
      <select name="truck_id" required>
        {% for t in trucks %}
          <option value="{{t.id}}">{{t.name}}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label>Driver</label>
      <select name="driver_id" required>
        {% for d in drivers %}
          <option value="{{d.id}}">{{d.name}}</option>
        {% endfor %}
      </select>
    </div>

    <div class="show-income">
      <label>Income Amount ($)</label>
      <input type="number" step="0.01" name="income_amount" value="0.00">
    </div>

    <div class="show-expense">
      <label>Expense Amount ($)</label>
      <input type="number" step="0.01" name="expense_amount" value="0.00">
    </div>

    <div class="show-expense">
      <label>Expense Category</label>
      <select name="expense_category">
        <option>Fuel</option>
        <option>Driver Pay</option>
        <option>Insurance</option>
        <option>Parking</option>
        <option>Other</option>
      </select>
    </div>

    <div class="show-expense">
      <label>HST</label>
      <select name="hst_option">
        <option value="with">With HST</option>
        <option value="without">Without HST</option>
      </select>
    </div>

    <div class="full">
      <label>Description</label>
      <textarea name="description" rows="2" placeholder="details..." required></textarea>
    </div>

    <div class="full">
      <button class="btn-primary" type="submit">Save Entry</button>
    </div>
  </form>
</div>

<div class="card">
  <h2>Filter by Date</h2>
  <form method="get" class="row-form">
    <div>
      <label>From</label>
      <input type="date" name="from">
    </div>
    <div>
      <label>To</label>
      <input type="date" name="to">
    </div>
    <div class="align-end">
      <button class="btn-primary" type="submit">Search</button>
    </div>
  </form>
</div>

<div class="card">
  <h2>Entries</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Date</th><th>Type</th><th>Truck</th><th>Driver</th>
        <th>Description</th><th>Amount</th><th>HST?</th><th>Edit</th><th>Delete</th>
      </tr>
    </thead>
    <tbody>
      {% if entries|length == 0 %}
        <tr><td colspan="9" class="empty">No data available.</td></tr>
      {% else %}
      {% for e in entries %}
        <tr>
          <td>{{e.entry_date}}</td>
          <td>{% if e.is_income==1 %}Income{% else %}Expense{% endif %}</td>
          <td>{{e.truck_name}}</td>
          <td>{{e.driver_name}}</td>
          <td>{{e.description}}</td>
          <td>${{ '%.2f'|format(e.amount) }}</td>
          <td>{% if e.hst_included==1 %}With{% else %}No{% endif %}</td>
          <td>
            <a class="btn-small" href="{{ url_for('edit_entry', id=e.id) }}">Edit</a>
          </td>
          <td>
            <form method="post" action="{{ url_for('delete_entry', id=e.id) }}" class="inline-form">
              <input type="password" name="delete_password" placeholder="Password" class="pw-box">
              <button class="btn-danger-small" type="submit">X</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      {% endif %}
    </tbody>
  </table>
</div>

<script>
function updateModeFields(){
  const mode = document.getElementById('modeSelect').value;
  document.querySelectorAll('.show-income').forEach(el=>{
    el.style.display = (mode === 'income') ? 'block' : 'none';
  });
  document.querySelectorAll('.show-expense').forEach(el=>{
    el.style.display = (mode === 'expense') ? 'block' : 'none';
  });
}
document.getElementById('modeSelect').addEventListener('change', updateModeFields);
updateModeFields();
</script>
{% endblock %}
